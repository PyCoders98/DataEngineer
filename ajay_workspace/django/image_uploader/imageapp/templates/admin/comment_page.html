{% extends "base.html" %}
{% load static %}
{% load custom_tags %}
{% block content %}
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li id="message-{{ forloop.counter }}"
                    class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 mb-4">
                    {% if message.tags %}<div class="font-bold">{{ message.tags }}</div>{% endif %}
                    <div>{{ message }}</div>
                </li>
            {% endfor %}
        </ul>
    {% endif %}
    <div class="max-w-2xl mx-auto bg-white p-8 rounded shadow-md">
        <h2 class="text-2xl">{{ data.user }}</h2>
        <div class="mb-4">
            <img src="/media/{{ data.image }}"
                 alt="Placeholder Image"
                 class="w-full rounded">
        </div>
        <div class="relative">
            {% is_liked data.id as liked %}
            <form>
                <button class="like-button"
                        data-id="{{ data.id }}"
                        data-url="{% url 'image_portfolio' data.id %}">
                    <i class="fa fa-heart {% if liked %}text-red-600{% else %}text-gray-400{% endif %}"
                       style="font-size:24px"></i>
                    <span>{{ data.like }}</span>
                </button>
            </form>
            {% comment %} <button class="like-button" data-id="{{ item.id }}" data-url="{% url 'image_portfolio' item.id %}">
                <i class="fa fa-heart {% if liked %}text-red-600{% else %}text-gray-400{% endif %}" style="font-size:24px"></i>
                {% if item.like %}{{ item.like }}{% endif %}
            </button> {% endcomment %}
        </div>
        <form action="{% url 'comment_page' data.id %}" method="POST" class="mb-4">
            {% csrf_token %}
            <label for="comment" class="block text-gray-700 font-bold mb-2">Your Comment:</label>
            <textarea id="comment"
                      name="comment"
                      rows="3"
                      class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                      placeholder="Leave your comment here..."></textarea>
            <button type="submit"
                    class="mt-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                Post Comment
            </button>
        </form>
    </div>
    <h2 class="text-lg font-semibold mb-4">Comments</h2>
    {% for comment in comment %}
        <div class="max-w-4xl mx-auto px-4 pb-4">
            <div>
                <!-- Single Comment -->
                <div class="bg-white shadow-md rounded-md p-4 mb-2">
                    <div class="flex items-start">
                        <div class="ml-4">
                            <div class="flex items-center">
                                <h3 class="text-lg font-semibold text-gray-900">{{ comment.username }}</h3>
                                <span class="text-sm text-gray-500 ml-2">{{ comment.created_at }}</span>
                            </div>
                            <p class="text-gray-600">{{ comment.comment }}</p>
                        </div>
                    </div>
                </div>
                <!-- Add more comments dynamically here if needed -->
            </div>
        </div>
    {% endfor %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            setTimeout(function () {
                var messages = document.querySelectorAll('.messages > li');
                messages.forEach(function (message) {
                    message.classList.add('hidden');
                });
            }, 3000); // Hide messages after 3 seconds
        });
            $(document).ready(function(){
                $(document).on('click', '.like-button', function(event){
                    event.preventDefault();
                    var $button = $(event.currentTarget);
                    var url = $button.data('url');
                    var $icon = $button.find('i');
                    var $span = $button.find('span');
                    console.log('Like button clicked:', url);
                    $.ajax({
                        url: url,
                        type: 'POST',
                        data: {
                            'like': 'like',
                            'csrfmiddlewaretoken': '{{ csrf_token }}'
                        },
                        success: function(response){
                            console.log('Like success:', response);
                            $icon.toggleClass('text-gray-400 text-red-600');
                            $span.text(response.like);
                        },
                        error: function(xhr, status, error) {
                            console.error('Like submission failed:', error, xhr.responseText);
                        }
                    });
                });
        
                $(document).on('click', '.dislike-button', function(event){
                    event.preventDefault();
                    var $button = $(event.currentTarget);
                    var url = $button.data('url');
                    var $icon = $button.find('i');
                    var $span = $button.find('span');
                    console.log('Dislike button clicked:', url);
                    $.ajax({
                        url: url,
                        type: 'POST',
                        data: {
                            'like': 'dislike',
                            'csrfmiddlewaretoken': '{{ csrf_token }}'
                        },
                        success: function(response){
                            console.log('Dislike success:', response);
                            $icon.toggleClass('text-gray-400 text-red-600');
                            $span.text(response.dislikes);
                        },
                        error: function(xhr, status, error) {
                            console.error('Dislike submission failed:', error, xhr.responseText);
                        }
                    });
                });
            });
    </script>
{% endblock content %}
